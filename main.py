import streamlit as st  # å¯¼å…¥ Streamlit åº“ï¼Œç”¨äºåˆ›å»º Web åº”ç”¨
from utils import generate_script  # ä» utils æ¨¡å—å¯¼å…¥ generate_script å‡½æ•°ï¼Œè¿™æ˜¯åç«¯ç”Ÿæˆè„šæœ¬çš„æ ¸å¿ƒé€»è¾‘

st.title("ğŸ¬ è§†é¢‘è„šæœ¬ç”Ÿæˆå™¨-è«ç„")  # è®¾ç½®åº”ç”¨çš„æ ‡é¢˜

with st.sidebar:  # åˆ›å»ºä¸€ä¸ªä¾§è¾¹æ ï¼Œç”¨äºç”¨æˆ·è¾“å…¥
    openai_api_key = st.text_input("è¯·è¾“å…¥OpenAI APIå¯†é’¥ï¼š", type="password")  # è¾“å…¥æ¡†ï¼Œç”¨æˆ·è¾“å…¥ OpenAI API å¯†é’¥
    st.markdown("[è·å–OpenAI APIå¯†é’¥](https://platform.openai.com/account/api-keys)")  # æä¾›è·å– API å¯†é’¥çš„é“¾æ¥

    # æ·»åŠ ä¸€ä¸ªä¸‹æ‹‰èœå•æ¥é€‰æ‹©æ¨¡å‹ç±»å‹
    # model_type = st.selectbox(
    #    "é€‰æ‹©æ¨¡å‹ç±»å‹ï¼š",
    #    ("gpt-3.5-turbo", "gpt-4", "davinci-codex")
    # )

subject = st.text_input("ğŸ’¡ è¯·è¾“å…¥è§†é¢‘çš„ä¸»é¢˜")  # è¾“å…¥æ¡†ï¼Œç”¨æˆ·è¾“å…¥è§†é¢‘çš„ä¸»é¢˜
video_length = st.number_input("â±ï¸ è¯·è¾“å…¥è§†é¢‘çš„å¤§è‡´æ—¶é•¿ï¼ˆå•ä½ï¼šåˆ†é’Ÿï¼‰", min_value=0.1, step=0.1)  # æ•°å€¼è¾“å…¥æ¡†ï¼Œç”¨æˆ·è¾“å…¥è§†é¢‘æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
creativity = st.slider("âœ¨ è¯·è¾“å…¥è§†é¢‘è„šæœ¬çš„åˆ›é€ åŠ›ï¼ˆæ•°å­—å°è¯´æ˜æ›´ä¸¥è°¨ï¼Œæ•°å­—å¤§è¯´æ˜æ›´å¤šæ ·ï¼‰", min_value=0.0, max_value=1.0, value=0.2, step=0.1)  # æ»‘å—ï¼Œç”¨æˆ·é€‰æ‹©åˆ›é€ åŠ›å‚æ•°
submit = st.button("ç”Ÿæˆè„šæœ¬")  # æŒ‰é’®ï¼Œç”¨æˆ·æäº¤è¾“å…¥ä¿¡æ¯

if submit and not openai_api_key:  # æ£€æŸ¥æ˜¯å¦è¾“å…¥ API å¯†é’¥
    st.info("è¯·è¾“å…¥ä½ çš„OpenAI APIå¯†é’¥")  # å¦‚æœæ²¡æœ‰è¾“å…¥ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
    st.stop()  # åœæ­¢æ‰§è¡Œ

if submit and not subject:  # æ£€æŸ¥æ˜¯å¦è¾“å…¥è§†é¢‘ä¸»é¢˜
    st.info("è¯·è¾“å…¥è§†é¢‘çš„ä¸»é¢˜")  # å¦‚æœæ²¡æœ‰è¾“å…¥ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
    st.stop()  # åœæ­¢æ‰§è¡Œ

if submit and not video_length >= 0.1:  # æ£€æŸ¥è§†é¢‘æ—¶é•¿æ˜¯å¦å¤§äºç­‰äº 0.AI åˆ†é’Ÿ
    st.info("è§†é¢‘é•¿åº¦éœ€è¦å¤§äºæˆ–ç­‰äº0.AI")  # å¦‚æœä¸ç¬¦åˆæ¡ä»¶ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
    st.stop()  # åœæ­¢æ‰§è¡Œ

if submit:  # å¦‚æœæ‰€æœ‰è¾“å…¥éƒ½æœ‰æ•ˆ
    with st.spinner("AIæ­£åœ¨æ€è€ƒä¸­ï¼Œè¯·ç¨ç­‰..."):  # æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼Œæç¤ºç”¨æˆ· AI æ­£åœ¨ç”Ÿæˆè„šæœ¬
        search_result, title, script = generate_script(subject, video_length, creativity, openai_api_key)  # è°ƒç”¨ generate_script å‡½æ•°ï¼Œä¼ å…¥ç”¨æˆ·è¾“å…¥çš„å‚æ•°ï¼Œå¹¶æ¥æ”¶è¿”å›ç»“æœ
    st.success("è§†é¢‘è„šæœ¬å·²ç”Ÿæˆï¼")  # æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼Œæç¤ºç”¨æˆ·è§†é¢‘è„šæœ¬å·²ç”Ÿæˆ
    st.subheader("ğŸ”¥ æ ‡é¢˜ï¼š")  # æ˜¾ç¤ºç”Ÿæˆçš„è§†é¢‘æ ‡é¢˜
    st.write(title)  # è¾“å‡ºç”Ÿæˆçš„æ ‡é¢˜
    st.subheader("ğŸ“ è§†é¢‘è„šæœ¬ï¼š")  # æ˜¾ç¤ºç”Ÿæˆçš„è§†é¢‘è„šæœ¬
    st.write(script)  # è¾“å‡ºç”Ÿæˆçš„è„šæœ¬
    with st.expander("ç»´åŸºç™¾ç§‘æœç´¢ç»“æœ ğŸ‘€"):  # æŠ˜å æ¡†ï¼Œæ˜¾ç¤ºç»´åŸºç™¾ç§‘æœç´¢ç»“æœ
        st.info(search_result)  # è¾“å‡ºç»´åŸºç™¾ç§‘æœç´¢ç»“æœ
